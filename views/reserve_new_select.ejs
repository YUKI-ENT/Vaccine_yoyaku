<%- include('./header.ejs', {Env: Env}); %>
<body>
  <%- include('./navbar.ejs', {Env: Env}); %>

  <div id="container" class="container">
    <nav aria-label="パンくずリスト">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="<%= Env.https_path %>">ホーム</a></li>
        <li class="breadcrumb-item active" aria-current="page">新規予約（人数選択）</li>
      </ol>
    </nav>

    <div class="jumbotron py-4">
      <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between">
        <div class="mb-3">
          <h2 class="mb-1">予約する人の選択</h2>
        </div>
      </div>

      <!-- プラン表示 -->
      <%- include('./plan_title.ejs', { plan: plan }); %>

      <!-- エラー表示 -->
      <% if (errors && errors.length > 0) { %>
        <div class="alert alert-danger mt-3" role="alert">
          <strong>入力内容をご確認ください</strong>
          <ul class="mb-0 mt-2">
            <% errors.forEach(function (value) { %>
              <li><%= value %></li>
            <% }); %>
          </ul>
        </div>
      <% } %>

      <!-- 案内 -->
      <div class="alert alert-info mt-3" role="alert">
        <ul class="mb-0">
          <li>同時に <strong>6人</strong> まで予約できます（7人以上は日付や時間帯を分けてください）。</li>
          <li>予約する方にチェックを入れて「次へ」を押してください。</li>
          <li class="text-muted">※年齢は接種日時点で判定されます。</li>
        </ul>
      </div>

      <!-- 選択フォーム -->
      <form action="<%= Env.https_path %>" method="get" class="mt-3">
        <input type="hidden" name="mode" value="reservenewcal" />
        <input type="hidden" name="plan" value="<%= plan.id %>" />

        <div class="card shadow-sm">
          <div class="card-header bg-light">
            <strong>予約する方を選択</strong>
          </div>

          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead>
                  <tr>
                    <th style="width:110px;">選択</th>
                    <th>氏名</th>
                    <th style="width:200px;">生年月日</th>
                  </tr>
                </thead>
                <tbody>
                  <% family.forEach(function (f) { %>
                    <tr class="<%= f.eligible ? '' : 'table-secondary' %>">
                      <td>
                        <div class="form-check m-0">
                          <input
                            type="checkbox"
                            name="ptuids[]"
                            id="ptuids<%= f.UID %>"
                            value="<%= f.UID %>"
                            class="form-check-input"
                            <%= f.eligible ? '' : 'disabled' %>
                          >
                          <label class="form-check-label" for="ptuids<%= f.UID %>">
                            予約
                          </label>
                        </div>
                      </td>

                      <td>
                        <strong><%= f.name1 %> <%= f.name2 %></strong> 様

                        <% if (f.age_note) { %>
                          <div class="small <%= f.eligible ? 'text-warning' : 'text-danger' %> mt-1">
                            <%= f.age_note %>
                          </div>
                        <% } %>

                        <% if (f.required_doses) { %>
                          <div class="small text-muted">
                            接種回数目安：<%= f.required_doses %>回
                          </div>
                        <% } %>
                      </td>

                      <td>
                        <span class="text-muted"><%= f.birth_disp %></span>
                        <div class="small text-muted">
                          現在 月齢 <%= f.age_m %> ヶ月
                        </div>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>

            <button type="submit" class="btn btn-primary btn-lg btn-block mt-4">
              次へ（日時選択へ）
            </button>

            <p class="text-muted small mt-2 mb-0">
              ※対象年齢外の方は選択できません。<br>
              ※「年齢要確認」の場合、接種日によっては予約できないことがあります。
            </p>
          </div>
        </div>
      </form>

      <!-- ナビ -->
      <div id="navi" class="form-group mt-3">
        <a href="#" class="btn btn-info m-1" role="button" id="backbtn">戻る</a>
        <a href="<%= Env.https_path %>" class="btn btn-outline-secondary m-1" role="button">ホームへ</a>
      </div>

    </div><!-- /.jumbotron -->
  </div><!-- /.container -->

  <%- include('./footer.ejs'); %>
</body>
</html>

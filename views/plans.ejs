<%- include('./header.ejs', {Env: Env}); %>

<body>
<%- include('./navbar.ejs', {Env: Env}); %>

<div id="container" class="container">
  <nav aria-label="パンくずリスト">
    <ol class="breadcrumb">
      <li class="breadcrumb-item active" aria-current="page">ホーム</li>
    </ol>
  </nav>

  <!-- トップだけJumbotron（予防接種っぽく簡潔に） -->
  <div class="jumbotron mb-4">
    <h3 class="mb-2"><%= ptinfo.name1 + ptinfo.name2 %> さん</h3>
    <p class="lead mb-0">今季の予防接種プランをお選びください。プランごとに接種期間・料金・対象が異なります。</p>
  </div>

  <!-- プラン一覧（カードで区切って視認性を上げる） -->
  <div id="plan" class="m-auto">
    <% plans.forEach(function (plan, key) { %>
      <section class="card mb-4 shadow-sm" id="plan-<%= plan.id %>">
        <div class="card-header bg-light">
          <h4 class="my-0 font-weight-normal">
            <%= plan.year %>年度 <%= plan.name %>
          </h4>
        </div>

        <div class="card-body">
          <!-- プランメッセージ／注意喚起 -->
          <ul class="mb-2">
            <% (plan.errors || []).forEach(function (value) { %>
              <li class="text-danger"><%= value %></li>
            <% }); %>
          </ul>
          <p class="text-info mb-3"><%= plan.text %></p>

          <!-- 受付状態 -->
          <h5 class="mt-2">予約受付</h5>
          <div class="row m-2 align-items-center">
            <div class="col-auto">
              <strong><%= plan.y_start %></strong> から
            </div>
            <div class="col-auto">
              <% if (plan.preopen == 0 && plan.full != 1) { %>
                <span class="btn btn-sm text-white bg-success ml-2">予約受付中</span>
              <% } else if (plan.full == 1) { %>
                <span class="btn btn-sm text-white bg-danger ml-2">満席／受付終了</span>
              <% } else { %>
                <span class="btn btn-sm text-white bg-warning ml-2">予約開始前</span>
              <% } %>
            </div>
          </div>

          <!-- 接種期間 -->
          <h5 class="mt-3">接種期間</h5>
          <p class="m-2">
            <strong><%= plan.start %></strong> から <strong><%= plan.end %></strong> まで
          </p>

          <!-- 料金 -->
          <h5 class="mt-3">料金</h5>
          <p class="m-2">
            1回目：<strong><%= plan.price1 %></strong> 円
            ／ 2回目：<strong><%= plan.price2 %></strong> 円
          </p>

          <!-- 接種回数・対象など -->
          <h5 class="mt-3">接種回数・対象</h5>
          <p class="m-2"><%= plan.detail %></p>

          <!-- 予防接種向けの備考 -->
          <h5 class="mt-3">ご案内</h5>
          <ul class="mb-3">
            <li>2回接種が必要なプランは、<strong>1回目と同時に2回目の予約</strong>をお取りください。</li>
            <li>新型コロナワクチンとの接種間隔制限はありません。</li>
            <li>接種時間：午前 9:30–11:30 ／ 午後 16:00–17:30（時間厳守のご協力をお願いします）。</li>
            <li>問診票は <a href="https://yuuki-jibika.com/blog/ent/flu_monsin.pdf" target="_blank" rel="noopener">こちら</a> からダウンロードできます。</li>
            <li>予約日前のリマインド配信をご希望の方は、<a href="<%= Env.https_path %>?mode=mailform">メール通知の登録</a>をご利用ください。</li>
            <% if (plan.preopen == 1) { %>
              <li class="mt-2">
                <p class="text-danger mb-0">
                  <%= plan.y_start %> から予約を開始します。現在「新規予約」「予約確認・変更・キャンセル」は選択できません。
                </p>
              </li>
            <% } %>
          </ul>

          <!-- 操作用ボタン（デスクトップ） -->
          <% if (plan.preopen == 1) { %>
            <!-- 予約開始前：操作を無効化 -->
            <div class="d-none d-md-block">
              <div class="btn-group d-flex mb-2">
                <a class="btn btn-lg btn-outline-primary disabled w-50" role="button" aria-disabled="true" href="<%= Env.https_path %>">新規予約</a>
                <a class="btn btn-lg btn-outline-primary disabled w-50" role="button" aria-disabled="true" href="<%= Env.https_path %>">予約確認・変更・キャンセル</a>
              </div>
              <div class="btn-group d-flex">
                <a class="btn btn-lg btn-outline-secondary w-50" role="button" href="<%= Env.https_path %>?mode=familyedit">家族情報の登録・削除</a>
                <a class="btn btn-lg btn-outline-secondary w-50" role="button" href="<%= Env.https_path %>?mode=mailform">メールアドレス登録・削除</a>
              </div>
            </div>

            <!-- 予約開始前：モバイル -->
            <div class="d-block d-md-none">
              <div class="btn-group-vertical d-flex">
                <a class="btn btn-lg btn-outline-primary disabled" role="button" aria-disabled="true" href="<%= Env.https_path %>">新規予約</a>
                <a class="btn btn-lg btn-outline-primary disabled" role="button" aria-disabled="true" href="<%= Env.https_path %>">予約確認・変更・キャンセル</a>
                <a class="btn btn-lg btn-outline-secondary" role="button" href="<%= Env.https_path %>?mode=familyedit">家族情報の登録・削除</a>
                <a class="btn btn-lg btn-outline-secondary" role="button" href="<%= Env.https_path %>?mode=mailform">メールアドレス登録・削除</a>
              </div>
            </div>
          <% } else { %>
            <!-- 受付中/満了：新規予約は満席で無効化、確認変更は常に可 -->
            <div class="d-none d-md-block">
              <div class="btn-group d-flex mb-2">
                <a class="btn btn-lg btn-outline-primary w-50 <%= plan.full == 1 ? 'disabled' : '' %>"
                   role="button"
                   aria-disabled="<%= plan.full == 1 ? 'true' : 'false' %>"
                   href="<%= plan.full == 1 ? Env.https_path : (Env.https_path + '?mode=reservenew&plan=' + plan.id) %>">新規予約</a>
                <a class="btn btn-lg btn-outline-primary w-50"
                   role="button"
                   href="<%= Env.https_path %>?mode=reservechange&plan=<%= plan.id %>">予約確認・変更・キャンセル</a>
              </div>
              <div class="btn-group d-flex">
                <a class="btn btn-lg btn-outline-secondary w-50" role="button" href="<%= Env.https_path %>?mode=familyedit">家族情報の登録・削除</a>
                <a class="btn btn-lg btn-outline-secondary w-50" role="button" href="<%= Env.https_path %>?mode=mailform">メールアドレス登録・削除</a>
              </div>
            </div>

            <div class="d-block d-md-none">
              <div class="btn-group-vertical d-flex">
                <a class="btn btn-lg btn-outline-primary <%= plan.full == 1 ? 'disabled' : '' %>"
                   role="button"
                   aria-disabled="<%= plan.full == 1 ? 'true' : 'false' %>"
                   href="<%= plan.full == 1 ? Env.https_path : (Env.https_path + '?mode=reservenew&plan=' + plan.id) %>">新規予約</a>
                <a class="btn btn-lg btn-outline-primary"
                   role="button"
                   href="<%= Env.https_path %>?mode=reservechange&plan=<%= plan.id %>">予約確認・変更・キャンセル</a>
                <a class="btn btn-lg btn-outline-secondary" role="button" href="<%= Env.https_path %>?mode=familyedit">家族情報の登録・削除</a>
                <a class="btn btn-lg btn-outline-secondary" role="button" href="<%= Env.https_path %>?mode=mailform">メールアドレス登録・削除</a>
              </div>
            </div>
          <% } %>
        </div><!-- /.card-body -->
      </section>
    <% }); %>
  </div>
</div>

<%- include('./footer.ejs'); %>
</body>
</html>

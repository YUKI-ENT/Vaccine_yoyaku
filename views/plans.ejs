<%- include('./header.ejs', {Env: Env}); %>

<body>
<%- include('./navbar.ejs', {Env: Env}); %>

<!-- ========== TOP HERO（横いっぱい） ========== -->
<div class="container-fluid px-0">
  <section class="bg-light border-bottom">
    <div class="container py-4">

      <!-- パンくず（トップは広いけど、パンくずは読み幅に合わせる） -->
      <nav aria-label="パンくずリスト">
        <ol class="breadcrumb bg-transparent px-0 mb-3">
          <li class="breadcrumb-item active" aria-current="page">ホーム</li>
        </ol>
      </nav>

      <!-- ヒーロー -->
      <div class="card shadow-sm">
        <div class="card-body p-4">

          <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between">
            <div class="mb-3 mb-md-0">
              <h2 class="mb-1">
                <%= ptinfo.name1 + ptinfo.name2 %> 様
              </h2>
              <p class="text-muted mb-0">
                予約する予防接種を選んでください。<br class="d-none d-md-block"/>
                ワクチンごとに接種期間・料金・対象が異なります。
              </p>
            </div>

            <!-- 右上に状態アイコンっぽい強調（好みで消してOK） -->
            <div>
              <span class="badge badge-pill badge-primary px-3 py-2">
                予防接種予約
              </span>
            </div>
          </div>

        </div>
      </div>

      <!-- 全体エラー（セッション切れ・バリデーション等） -->
      <% if (errors && errors.length) { %>
        <div class="alert alert-danger mt-3 mb-0">
          <% errors.forEach(function(e){ %>
            <div><%= e %></div>
          <% }); %>
        </div>
      <% } %>

    </div>
  </section>
</div>


<!-- ========== MAIN（ここからは読みやすい container） ========== -->
<div id="container" class="container py-4">

  <!-- 共通メニュー（プランに関係なく常に表示） -->
  <section class="card mb-4 shadow-sm">
    <div class="card-header bg-light">
      <h4 class="my-0 font-weight-normal">メニュー</h4>
    </div>

    <div class="card-body">
      <div class="row">
        <!-- 全予約 -->
        <div class="col-12 col-md-4 mb-3 mb-md-0">
          <a class="btn btn-lg btn-outline-primary w-100"
             role="button"
             href="<%= Env.https_path %>?mode=reservechange">
            全予約の確認・変更・キャンセル
          </a>
        </div>

        <!-- 家族情報 -->
        <div class="col-12 col-md-4 mb-3 mb-md-0">
          <a class="btn btn-lg btn-outline-secondary w-100"
             role="button"
             href="<%= Env.https_path %>?mode=familyedit">
            家族情報の登録・削除
          </a>
        </div>

        <!-- メール -->
        <div class="col-12 col-md-4">
          <a class="btn btn-lg btn-outline-secondary w-100"
             role="button"
             href="<%= Env.https_path %>?mode=mailform">
            メールアドレス登録・削除
          </a>
        </div>
      </div>
    </div>
  </section>


  <!-- プラン一覧 -->
  <div id="plan">

    <% if (!plans || plans.length === 0) { %>

      <div class="alert alert-info">
        現在、本システムで予約受付中の予防接種はありません。
      </div>

    <% } else { %>

      <% plans.forEach(function (plan) { %>
        <section class="card mb-4 shadow-sm" id="plan-<%= plan.id %>">

          <div class="card-header bg-light">
            <h4 class="my-0 font-weight-normal">
              <%= plan.year %>年度 <%= plan.name %>
            </h4>
          </div>

          <div class="card-body">

            <!-- プラン個別の警告（満員/残枠少など） -->
            <% if (plan.warn) { %>
              <div class="alert alert-warning mb-3"><%= plan.warn %></div>
            <% } %>

            <!-- 受付状態 -->
            <div class="mb-3">
              <div class="d-flex align-items-center flex-wrap">
                <h5 class="mb-0 mr-2">予約受付</h5>

                <% if (plan.preopen == 0 && plan.full != 1) { %>
                  <span class="badge badge-success ml-2">受付中</span>
                <% } else if (plan.full == 1) { %>
                  <span class="badge badge-danger ml-2">満席／受付終了</span>
                <% } else { %>
                  <span class="badge badge-warning ml-2">予約開始前</span>
                <% } %>
              </div>

              <div class="text-muted mt-2">
                <strong><%= plan.y_start %></strong> から
              </div>
            </div>

            <!-- 接種期間 -->
            <div class="mb-3">
              <h5>接種期間</h5>
              <div class="text-muted">
                <strong><%= plan.start %></strong> から <strong><%= plan.end %></strong> まで
              </div>
            </div>

            <!-- 料金 -->
            <div class="mb-3">
              <h5>料金</h5>
              <div class="text-muted">
                1回目：<strong><%= plan.price1 %></strong> 円
                ／ 2回目：<strong><%= plan.price2 %></strong> 円
              </div>
            </div>

            <!-- 接種回数・対象など -->
            <div class="mb-3">
              <h5>接種回数・対象</h5>
              <div class="text-muted"><%- plan.text %></div>
            </div>

            <!-- ご案内 -->
            <div class="mb-3">
              <h5>ご案内</h5>
              <div class="text-muted"><%- plan.detail %></div>
            </div>

            <% if (plan.preopen == 1) { %>
              <div class="alert alert-danger">
                <%= plan.y_start %> から予約を開始します。現在「新規予約」「予約確認・変更・キャンセル」は選択できません。
              </div>
            <% } %>

            <!-- 操作用ボタン -->
            <% if (plan.preopen == 1) { %>

              <div class="row">
                <div class="col-12 col-md-6 mb-2 mb-md-0">
                  <a class="btn btn-lg btn-outline-primary w-100 disabled" role="button" aria-disabled="true"
                     href="<%= Env.https_path %>">新規予約</a>
                </div>
                <div class="col-12 col-md-6">
                  <a class="btn btn-lg btn-outline-primary w-100 disabled" role="button" aria-disabled="true"
                     href="<%= Env.https_path %>">予約確認・変更・キャンセル</a>
                </div>
              </div>

            <% } else { %>

              <div class="row">
                <div class="col-12 col-md-6 mb-2 mb-md-0">
                  <a class="btn btn-lg btn-outline-primary w-100 <%= plan.full == 1 ? 'disabled' : '' %>"
                     role="button"
                     aria-disabled="<%= plan.full == 1 ? 'true' : 'false' %>"
                     href="<%= plan.full == 1 ? Env.https_path : (Env.https_path + '?mode=reservenew&plan=' + plan.id) %>">
                     新規予約
                  </a>
                </div>

                <div class="col-12 col-md-6">
                  <a class="btn btn-lg btn-outline-primary w-100"
                     role="button"
                     href="<%= Env.https_path %>?mode=reservechange&plan=<%= plan.id %>">
                    予約確認・変更・キャンセル
                  </a>
                </div>
              </div>

            <% } %>

          </div><!-- /.card-body -->
        </section>
      <% }); %>

    <% } %>

  </div>
</div>

<%- include('./footer.ejs'); %>
</body>
</html>
